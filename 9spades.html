<html>

<head>
    <title>9 of Spades - Metasploit Community CTF 2021 | JustineCybz</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <div id="menu">
        
        <h2>CTF Write-Ups</h2>
        <p>Misc.</p>
        <ul>
            <li><a href="uswdockerevent.html">USW Docker Event</a></li>
        </ul>
        <p>Metasploit Community CTF 2021
            <ul>
                <li><a href="9spades.html">Port 20055 - 9 of Spades</a></li>
                <li><a href="4clubs.html">Port 15010 - 4 of Clubs</a></li>
            </ul>
        </p>
        <p>Hack The Box CTF 2020
            <ul>
                <li><a href="block.html">Hardware - Block</a></li>
            </ul>

        </p>
    </div>
    <div id="container">
        <h2>Metasploit Community CTF</h2>
        <h1>Port 20055 - 9 of Spades</h1>
        <p>navigating to 127.0.0.1:20055, we are met with a page for &quot;Grant&#39;s Secure File Upload Server&quot;.
        </p>
        <p><img src="assets\images\9spades\Untitled.png" alt="Untitled"></p>
        <p>As the page states that the flag is located at root, a shell will likely be needed to access the root folder
            and as the website uses php, a php reverse shell would be a safe bet.</p>
        <p><code>cp /usr/share/webshells/php/php-reverse-shell.php</code></p>
        <p><img src="assets\images\9spades\Untitled1.png" alt="Untitled"></p>
        <p>Change the $ip to the local IP address of the attacking machine, as the targets are on the same network.</p>
        <p><img src="assets\images\9spades\Untitled2.png" alt="Untitled"></p>
        <p>Choose an available port. 443 was used as it is usually available for web shells.</p>
        <p>Now we have created our shell, we need to find a way to upload it.</p>
        <p>The source code for <em>upload.php</em> shows that many php file extensions have been blocked. We will need
            to use a different extension to bypass the block.</p>
        <p><img src="assets\images\9spades\Untitled3.png" alt="Untitled"></p>
        <p><img src="assets\images\9spades\Untitled4.png" alt="Untitled"></p>
        <p>Changing the file extension from <em>php</em> to <em>php12</em> worked to bypass the block.</p>
        <p>However, when attempting the access the file, we are now met with the source code being printed to the page
            rather than being executed by the server.</p>
        <p>This will need to be included in the .htaccess file for the local folder.</p>
        <p>Thankfully, this file upload allows for rewriting of existing files. We can just create a new .htaccess file
            with the necessary configuration to allow the execution of .php12 files!</p>
        <p><code>AddType application/x-httpd-php .php12</code></p>
        <p>When trying to access the reverse shell again we are now given the following errors:</p>
        <p><img src="assets\images\9spades\Untitled5.png" alt="Untitled"></p>
        <p>This means the server has executed the shell but we need to set up the listener on the attacking machine.</p>
        <p><code>nc -lvnp 443</code></p>
        <p><img src="assets\images\9spades\Untitled6.png" alt="Untitled"></p>
        <p>The flag is visible in the <code>ls</code> output!</p>
        <pre><code class="lang-bash">$ md5sum <span class="hljs-built_in">flag</span>.png
    <span class="hljs-number">270</span>d4a0a9abc1c048102ff8b91f10927  <span class="hljs-built_in">flag</span>.png
    </code></pre>

    </div>
</body>

</html>